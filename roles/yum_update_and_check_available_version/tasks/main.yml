- name: update all packages (please be patient)
  yum:
    name: '*'
    state: latest
    exclude: "{{ package_name }}"
  register: yum_updates

- name: Check if reboot_required
  shell:
    cmd: "needs-restarting -r"
  failed_when: reboot_required.rc != 0 and reboot_required.rc != 1
  register: reboot_required

- name: check available versions
  yum:
    name: "{{ package_name }}"
    state: latest
  check_mode: true
  register: yum_latest_versions
  failed_when: yum_latest_versions.changed == false and reboot_required.rc == 0